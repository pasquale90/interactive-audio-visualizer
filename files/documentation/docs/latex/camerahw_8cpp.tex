\hypertarget{camerahw_8cpp}{}\doxysection{src/gui/camerahw.cpp File Reference}
\label{camerahw_8cpp}\index{src/gui/camerahw.cpp@{src/gui/camerahw.cpp}}
{\ttfamily \#include $<$algorithm$>$}\newline
{\ttfamily \#include $<$unordered\+\_\+set$>$}\newline
{\ttfamily \#include $<$cstring$>$}\newline
{\ttfamily \#include $<$linux/videodev2.\+h$>$}\newline
{\ttfamily \#include $<$sys/ioctl.\+h$>$}\newline
{\ttfamily \#include $<$fcntl.\+h$>$}\newline
{\ttfamily \#include $<$unistd.\+h$>$}\newline
{\ttfamily \#include \char`\"{}gui/camerahw.\+h\char`\"{}}\newline
Include dependency graph for camerahw.\+cpp\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{camerahw_8cpp__incl}
\end{center}
\end{figure}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
std\+::vector$<$ \mbox{\hyperlink{structCameraInfo}{Camera\+Info}} $>$ \mbox{\hyperlink{camerahw_8cpp_a3d0a95992cb94b91094a9251b01b821c}{get\+Available\+Cameras}} ()
\begin{DoxyCompactList}\small\item\em Retrieves information about available cameras on the system. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Function Documentation}
\mbox{\Hypertarget{camerahw_8cpp_a3d0a95992cb94b91094a9251b01b821c}\label{camerahw_8cpp_a3d0a95992cb94b91094a9251b01b821c}} 
\index{camerahw.cpp@{camerahw.cpp}!getAvailableCameras@{getAvailableCameras}}
\index{getAvailableCameras@{getAvailableCameras}!camerahw.cpp@{camerahw.cpp}}
\doxysubsubsection{\texorpdfstring{getAvailableCameras()}{getAvailableCameras()}}
{\footnotesize\ttfamily std\+::vector$<$ \mbox{\hyperlink{structCameraInfo}{Camera\+Info}} $>$ get\+Available\+Cameras (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Retrieves information about available cameras on the system. 

This function scans the system for connected cameras and gathers information about each camera, including its device path and supported resolutions.

\begin{DoxyReturn}{Returns}
A vector of \mbox{\hyperlink{structCameraInfo}{Camera\+Info}} structures, where each structure contains information about a single camera. If no cameras are found, an empty vector is returned. 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{camerahw_8cpp_source_l00015}{15}} of file \mbox{\hyperlink{camerahw_8cpp_source}{camerahw.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00015                                             \{}
\DoxyCodeLine{00016     std::vector<CameraInfo> cameras;}
\DoxyCodeLine{00017     std::unordered\_set<std::string> uniquesResolutionValues;}
\DoxyCodeLine{00018 }
\DoxyCodeLine{00019     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < 16; ++i) \{ \textcolor{comment}{// Check up to 16 potential camera devices}}
\DoxyCodeLine{00020         std::string devicePath = \textcolor{stringliteral}{"{}/dev/video"{}} + std::to\_string(i);}
\DoxyCodeLine{00021         \textcolor{keywordtype}{int} fd = open(devicePath.c\_str(), O\_RDWR | O\_NONBLOCK, 0);}
\DoxyCodeLine{00022 }
\DoxyCodeLine{00023         \textcolor{keywordflow}{if} (fd == -\/1) \{}
\DoxyCodeLine{00024             \textcolor{keywordflow}{if} (errno == ENOENT || errno == EACCES) \{}
\DoxyCodeLine{00025                 \textcolor{keywordflow}{continue}; \textcolor{comment}{// Device doesn't exist or no permission, try next}}
\DoxyCodeLine{00026             \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00027                 perror(\textcolor{stringliteral}{"{}open"{}});}
\DoxyCodeLine{00028                 \textcolor{keywordflow}{continue}; \textcolor{comment}{// Some other error, try next}}
\DoxyCodeLine{00029             \}}
\DoxyCodeLine{00030         \}}
\DoxyCodeLine{00031 }
\DoxyCodeLine{00032 }
\DoxyCodeLine{00033         \textcolor{keyword}{struct }v4l2\_capability cap;}
\DoxyCodeLine{00034         \textcolor{keywordflow}{if} (ioctl(fd, VIDIOC\_QUERYCAP, \&cap) == -\/1) \{}
\DoxyCodeLine{00035             perror(\textcolor{stringliteral}{"{}VIDIOC\_QUERYCAP"{}});}
\DoxyCodeLine{00036             close(fd);}
\DoxyCodeLine{00037             \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00038         \}}
\DoxyCodeLine{00039 }
\DoxyCodeLine{00040         \textcolor{keywordflow}{if} (!(cap.capabilities \& V4L2\_CAP\_VIDEO\_CAPTURE)) \{}
\DoxyCodeLine{00041              \textcolor{comment}{//Not a video capture device}}
\DoxyCodeLine{00042             close(fd);}
\DoxyCodeLine{00043             \textcolor{keywordflow}{continue};}
\DoxyCodeLine{00044         \}}
\DoxyCodeLine{00045 }
\DoxyCodeLine{00046         \mbox{\hyperlink{structCameraInfo}{CameraInfo}} camera;}
\DoxyCodeLine{00047         camera.\mbox{\hyperlink{structCameraInfo_aae33d6b66dff390f7de58e343745cf22}{devicePath}} = devicePath;}
\DoxyCodeLine{00048 }
\DoxyCodeLine{00049 }
\DoxyCodeLine{00050 }
\DoxyCodeLine{00051         \textcolor{keyword}{struct }v4l2\_fmtdesc fmtdesc;}
\DoxyCodeLine{00052         memset(\&fmtdesc, 0, \textcolor{keyword}{sizeof}(fmtdesc));}
\DoxyCodeLine{00053         fmtdesc.index = 0;}
\DoxyCodeLine{00054         fmtdesc.type = V4L2\_BUF\_TYPE\_VIDEO\_CAPTURE;}
\DoxyCodeLine{00055 }
\DoxyCodeLine{00056         \textcolor{keywordflow}{while} (ioctl(fd, VIDIOC\_ENUM\_FMT, \&fmtdesc) == 0) \{}
\DoxyCodeLine{00057             \textcolor{keyword}{struct }v4l2\_frmsizeenum frmsizeenum;}
\DoxyCodeLine{00058             memset(\&frmsizeenum, 0, \textcolor{keyword}{sizeof}(frmsizeenum));}
\DoxyCodeLine{00059             frmsizeenum.index = 0;}
\DoxyCodeLine{00060             frmsizeenum.pixel\_format = fmtdesc.pixelformat;}
\DoxyCodeLine{00061 }
\DoxyCodeLine{00062             \textcolor{keywordflow}{while} (ioctl(fd, VIDIOC\_ENUM\_FRAMESIZES, \&frmsizeenum) == 0) \{}
\DoxyCodeLine{00063 }
\DoxyCodeLine{00064                 \textcolor{keywordflow}{if} (frmsizeenum.type == V4L2\_FRMSIZE\_TYPE\_DISCRETE) \{}
\DoxyCodeLine{00065                     std::string resVal = std::to\_string(frmsizeenum.discrete.width) +\textcolor{stringliteral}{"{}x"{}}+ std::to\_string(frmsizeenum.discrete.height);}
\DoxyCodeLine{00066                     \textcolor{keywordflow}{if}(uniquesResolutionValues.find(resVal)== uniquesResolutionValues.end())\{}
\DoxyCodeLine{00067                         camera.\mbox{\hyperlink{structCameraInfo_a3d087eed7588f561a3fc89d4420aba53}{resolutions}}.push\_back(\{frmsizeenum.discrete.width, frmsizeenum.discrete.height\});}
\DoxyCodeLine{00068                         uniquesResolutionValues.insert(resVal);}
\DoxyCodeLine{00069                     \}}
\DoxyCodeLine{00070                 \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (frmsizeenum.type == V4L2\_FRMSIZE\_TYPE\_STEPWISE) \{}
\DoxyCodeLine{00071                      \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} w = frmsizeenum.stepwise.min\_width; w <= frmsizeenum.stepwise.max\_width; w += frmsizeenum.stepwise.step\_width) \{}
\DoxyCodeLine{00072                         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{size\_t} h = frmsizeenum.stepwise.min\_height; h <= frmsizeenum.stepwise.max\_height; h += frmsizeenum.stepwise.step\_height) \{}
\DoxyCodeLine{00073 }
\DoxyCodeLine{00074                             std::string resVal = std::to\_string(w) +\textcolor{stringliteral}{"{}x"{}}+ std::to\_string(h);}
\DoxyCodeLine{00075                             \textcolor{keywordflow}{if}(uniquesResolutionValues.find(resVal)== uniquesResolutionValues.end())\{}
\DoxyCodeLine{00076                                 camera.\mbox{\hyperlink{structCameraInfo_a3d087eed7588f561a3fc89d4420aba53}{resolutions}}.push\_back(\{w,h\});}
\DoxyCodeLine{00077                                 uniquesResolutionValues.insert(resVal);}
\DoxyCodeLine{00078                             \}}
\DoxyCodeLine{00079                         \}}
\DoxyCodeLine{00080                     \}}
\DoxyCodeLine{00081                 \}}
\DoxyCodeLine{00082                 }
\DoxyCodeLine{00083                 frmsizeenum.index++;}
\DoxyCodeLine{00084             \}}
\DoxyCodeLine{00085              fmtdesc.index++;}
\DoxyCodeLine{00086         \}}
\DoxyCodeLine{00087 }
\DoxyCodeLine{00088         std::sort(camera.\mbox{\hyperlink{structCameraInfo_a3d087eed7588f561a3fc89d4420aba53}{resolutions}}.begin(),camera.\mbox{\hyperlink{structCameraInfo_a3d087eed7588f561a3fc89d4420aba53}{resolutions}}.end(),compareResolutions);}
\DoxyCodeLine{00089         cameras.push\_back(camera);}
\DoxyCodeLine{00090         close(fd);}
\DoxyCodeLine{00091     \}}
\DoxyCodeLine{00092     \textcolor{keywordflow}{return} cameras;}
\DoxyCodeLine{00093 \}}

\end{DoxyCode}
