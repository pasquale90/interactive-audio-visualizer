\hypertarget{classWaveform}{}\doxysection{Waveform Class Reference}
\label{classWaveform}\index{Waveform@{Waveform}}


A circular buffer for storing audio samples.  




{\ttfamily \#include $<$waveform.\+h$>$}

\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{classWaveform_a4a10db706dde8126a190a650f0b639fb}{Waveform}} ()
\begin{DoxyCompactList}\small\item\em Default constructor. \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{classWaveform_a6b4f4455a6a8ae2222f967e88b80460b}{write}} (const float \&)
\begin{DoxyCompactList}\small\item\em Writes a new sample to the buffer. Advances the write position by one. \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{classWaveform_ad4309d03c34e0b7ebe173ee8bd536116}{read}} (float \&)
\begin{DoxyCompactList}\small\item\em Reads a sample from the buffer. Advances the read position by one. \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{classWaveform_ab6511211e5b81756a2a6a502ba1f0d4b}{is\+Empty}} () const
\begin{DoxyCompactList}\small\item\em Checks if the buffer is empty. \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{classWaveform_ac92843770623eb8e7d4d3b34bb5eef7a}{is\+Full}} () const
\item 
size\+\_\+t \mbox{\hyperlink{classWaveform_a55aadc54c0329bb9e25fecbf895b71f2}{size}} () const
\begin{DoxyCompactList}\small\item\em Returns the capacity of the buffer. \end{DoxyCompactList}\item 
size\+\_\+t \mbox{\hyperlink{classWaveform_affe280dcbbde4ed935db6ad3f5d6cc80}{available\+For\+Reading}} () const
\begin{DoxyCompactList}\small\item\em Returns the number of samples that can be read from the buffer without blocking. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{classWaveform_a57d9f5fae074ff6e3d7d1f687442e427}{get\+Min\+Max}} (float\mbox{[}2\mbox{]})
\begin{DoxyCompactList}\small\item\em Calculates and returns the minimum and maximum values in the buffer. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
A circular buffer for storing audio samples. 

\begin{DoxyNote}{Note}
The buffer is circular, meaning that when the write position reaches the buffer size, it wraps around to the beginning. 
\end{DoxyNote}


Definition at line \mbox{\hyperlink{waveform_8h_source_l00012}{12}} of file \mbox{\hyperlink{waveform_8h_source}{waveform.\+h}}.



\doxysubsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classWaveform_a4a10db706dde8126a190a650f0b639fb}\label{classWaveform_a4a10db706dde8126a190a650f0b639fb}} 
\index{Waveform@{Waveform}!Waveform@{Waveform}}
\index{Waveform@{Waveform}!Waveform@{Waveform}}
\doxysubsubsection{\texorpdfstring{Waveform()}{Waveform()}}
{\footnotesize\ttfamily Waveform\+::\+Waveform (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Default constructor. 



Definition at line \mbox{\hyperlink{waveform_8cpp_source_l00005}{5}} of file \mbox{\hyperlink{waveform_8cpp_source}{waveform.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00005                   : readpos(0), writepos(0)\{}
\DoxyCodeLine{00006     \textcolor{comment}{// calculate num of buffers per display frame;}}
\DoxyCodeLine{00007     \textcolor{keywordtype}{int} audioSamplesPerFrame = \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{int}\textcolor{keyword}{>}(cfg.\mbox{\hyperlink{classConfig_a9f58fb425653b02d94a2961f7bdd9e45}{audconf}}.\mbox{\hyperlink{structAudioConfig_aa893cf0e18009ba2aeb67a105d42aa71}{sampleRate}}.load() / cfg.\mbox{\hyperlink{classConfig_ab6692268f819ce3f8474d1d791f3aaee}{dispconf}}.\mbox{\hyperlink{structDisplayConfig_aefdc15d97fa0d2e067d5efcfda0f4947}{fps}}.load());}
\DoxyCodeLine{00008     \textcolor{keywordtype}{int} buffersPerFrame = std::ceil( \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{float}\textcolor{keyword}{>}(audioSamplesPerFrame) / \textcolor{keyword}{static\_cast<}\textcolor{keywordtype}{float}\textcolor{keyword}{>}(cfg.\mbox{\hyperlink{classConfig_a9f58fb425653b02d94a2961f7bdd9e45}{audconf}}.\mbox{\hyperlink{structAudioConfig_ae81381142d99bc1845cb33bd048643df}{bufferSize}}.load()));}
\DoxyCodeLine{00009     audioSamplesPerFrame = (buffersPerFrame+1) * cfg.\mbox{\hyperlink{classConfig_a9f58fb425653b02d94a2961f7bdd9e45}{audconf}}.\mbox{\hyperlink{structAudioConfig_ae81381142d99bc1845cb33bd048643df}{bufferSize}}.load(); \textcolor{comment}{// add 1 and make it divisible by bufferSize.}}
\DoxyCodeLine{00010 }
\DoxyCodeLine{00011     waveTable.reserve(audioSamplesPerFrame);}
\DoxyCodeLine{00012     waveTable.resize(audioSamplesPerFrame);}
\DoxyCodeLine{00013     }
\DoxyCodeLine{00014     capacity = (size\_t)audioSamplesPerFrame;}
\DoxyCodeLine{00015     min = INT\_MAX, max = 0.;}
\DoxyCodeLine{00016 \}}

\end{DoxyCode}


\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{classWaveform_affe280dcbbde4ed935db6ad3f5d6cc80}\label{classWaveform_affe280dcbbde4ed935db6ad3f5d6cc80}} 
\index{Waveform@{Waveform}!availableForReading@{availableForReading}}
\index{availableForReading@{availableForReading}!Waveform@{Waveform}}
\doxysubsubsection{\texorpdfstring{availableForReading()}{availableForReading()}}
{\footnotesize\ttfamily size\+\_\+t Waveform\+::available\+For\+Reading (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const}



Returns the number of samples that can be read from the buffer without blocking. 

\begin{DoxyReturn}{Returns}
size\+\_\+t -\/ the number of samples available for reading. 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{waveform_8cpp_source_l00068}{68}} of file \mbox{\hyperlink{waveform_8cpp_source}{waveform.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00068                                            \{}
\DoxyCodeLine{00069     \textcolor{keywordtype}{size\_t} writePos = writepos.load();}
\DoxyCodeLine{00070     \textcolor{keywordtype}{size\_t} readPos = readpos.load();}
\DoxyCodeLine{00071     \textcolor{keywordflow}{if} (writePos >= readPos) \{}
\DoxyCodeLine{00072         \textcolor{keywordflow}{return} writePos -\/ readPos;  \textcolor{comment}{// Normal case, no wraparound}}
\DoxyCodeLine{00073     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{00074         \textcolor{keywordflow}{return} waveTable.size() -\/ (readPos -\/ writePos);  \textcolor{comment}{// Wraparound case}}
\DoxyCodeLine{00075     \}}
\DoxyCodeLine{00076 \}}

\end{DoxyCode}
\mbox{\Hypertarget{classWaveform_a57d9f5fae074ff6e3d7d1f687442e427}\label{classWaveform_a57d9f5fae074ff6e3d7d1f687442e427}} 
\index{Waveform@{Waveform}!getMinMax@{getMinMax}}
\index{getMinMax@{getMinMax}!Waveform@{Waveform}}
\doxysubsubsection{\texorpdfstring{getMinMax()}{getMinMax()}}
{\footnotesize\ttfamily void Waveform\+::get\+Min\+Max (\begin{DoxyParamCaption}\item[{float}]{min\+Max\mbox{[}2\mbox{]} }\end{DoxyParamCaption})}



Calculates and returns the minimum and maximum values in the buffer. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ out}}  & {\em float\mbox{[}2\mbox{]}} & min\+\_\+max -\/ The minimum and maximum values in the buffer. 0th element is minimum, 1st element is maximum. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void
\end{DoxyReturn}
Retrieves the minimum and maximum values from the waveform. 
\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ out}}  & {\em min} & The minimum value (output parameter). \\
\hline
\mbox{\texttt{ out}}  & {\em max} & The maximum value (output parameter). \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{waveform_8cpp_source_l00083}{83}} of file \mbox{\hyperlink{waveform_8cpp_source}{waveform.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00083                                        \{}
\DoxyCodeLine{00084     minMax[0] = this-\/>min;}
\DoxyCodeLine{00085     minMax[1] = this-\/>max;}
\DoxyCodeLine{00086 \}}

\end{DoxyCode}
\mbox{\Hypertarget{classWaveform_ab6511211e5b81756a2a6a502ba1f0d4b}\label{classWaveform_ab6511211e5b81756a2a6a502ba1f0d4b}} 
\index{Waveform@{Waveform}!isEmpty@{isEmpty}}
\index{isEmpty@{isEmpty}!Waveform@{Waveform}}
\doxysubsubsection{\texorpdfstring{isEmpty()}{isEmpty()}}
{\footnotesize\ttfamily bool Waveform\+::is\+Empty (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const}



Checks if the buffer is empty. 

\begin{DoxyReturn}{Returns}
bool -\/ true if the buffer is empty, false otherwise. 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{waveform_8cpp_source_l00056}{56}} of file \mbox{\hyperlink{waveform_8cpp_source}{waveform.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00056                              \{}
\DoxyCodeLine{00057     \textcolor{keywordflow}{return} readpos.load() == writepos.load();}
\DoxyCodeLine{00058 \}}

\end{DoxyCode}
\mbox{\Hypertarget{classWaveform_ac92843770623eb8e7d4d3b34bb5eef7a}\label{classWaveform_ac92843770623eb8e7d4d3b34bb5eef7a}} 
\index{Waveform@{Waveform}!isFull@{isFull}}
\index{isFull@{isFull}!Waveform@{Waveform}}
\doxysubsubsection{\texorpdfstring{isFull()}{isFull()}}
{\footnotesize\ttfamily bool Waveform\+::is\+Full (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const}



Definition at line \mbox{\hyperlink{waveform_8cpp_source_l00060}{60}} of file \mbox{\hyperlink{waveform_8cpp_source}{waveform.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00060                             \{}
\DoxyCodeLine{00061     \textcolor{keywordflow}{return} (( writepos.load() + 1 ) \% waveTable.size()) == readpos.load();}
\DoxyCodeLine{00062 \}}

\end{DoxyCode}
\mbox{\Hypertarget{classWaveform_ad4309d03c34e0b7ebe173ee8bd536116}\label{classWaveform_ad4309d03c34e0b7ebe173ee8bd536116}} 
\index{Waveform@{Waveform}!read@{read}}
\index{read@{read}!Waveform@{Waveform}}
\doxysubsubsection{\texorpdfstring{read()}{read()}}
{\footnotesize\ttfamily bool Waveform\+::read (\begin{DoxyParamCaption}\item[{float \&}]{result }\end{DoxyParamCaption})}



Reads a sample from the buffer. Advances the read position by one. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ out}}  & {\em float\&} & sample -\/ the sample to be read. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
bool -\/ true if the sample was successfully read, false otherwise. 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{waveform_8cpp_source_l00038}{38}} of file \mbox{\hyperlink{waveform_8cpp_source}{waveform.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00038                                 \{}
\DoxyCodeLine{00039 }
\DoxyCodeLine{00040     \textcolor{keyword}{auto} readPos = readpos.load();}
\DoxyCodeLine{00041 }
\DoxyCodeLine{00042     \textcolor{comment}{// if buffer is empty return false  }}
\DoxyCodeLine{00043     \textcolor{keywordflow}{if} (readPos == writepos.load())\{}
\DoxyCodeLine{00044         \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{00045     \}}
\DoxyCodeLine{00046 }
\DoxyCodeLine{00047     \textcolor{comment}{// move data out of the buffer;}}
\DoxyCodeLine{00048     result = waveTable[readPos];}
\DoxyCodeLine{00049 }
\DoxyCodeLine{00050     \textcolor{comment}{// advance the read pointer}}
\DoxyCodeLine{00051     \textcolor{keyword}{auto} nextReadPos = (readPos + 1) \% waveTable.size();}
\DoxyCodeLine{00052     readpos.store(nextReadPos);}
\DoxyCodeLine{00053     \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00054 \}}

\end{DoxyCode}
\mbox{\Hypertarget{classWaveform_a55aadc54c0329bb9e25fecbf895b71f2}\label{classWaveform_a55aadc54c0329bb9e25fecbf895b71f2}} 
\index{Waveform@{Waveform}!size@{size}}
\index{size@{size}!Waveform@{Waveform}}
\doxysubsubsection{\texorpdfstring{size()}{size()}}
{\footnotesize\ttfamily size\+\_\+t Waveform\+::size (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption}) const}



Returns the capacity of the buffer. 

\begin{DoxyReturn}{Returns}
size\+\_\+t -\/ the capacity of the buffer. 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{waveform_8cpp_source_l00064}{64}} of file \mbox{\hyperlink{waveform_8cpp_source}{waveform.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00064                             \{ }
\DoxyCodeLine{00065     \textcolor{keywordflow}{return} capacity;}
\DoxyCodeLine{00066 \}}

\end{DoxyCode}
\mbox{\Hypertarget{classWaveform_a6b4f4455a6a8ae2222f967e88b80460b}\label{classWaveform_a6b4f4455a6a8ae2222f967e88b80460b}} 
\index{Waveform@{Waveform}!write@{write}}
\index{write@{write}!Waveform@{Waveform}}
\doxysubsubsection{\texorpdfstring{write()}{write()}}
{\footnotesize\ttfamily bool Waveform\+::write (\begin{DoxyParamCaption}\item[{const float \&}]{arg }\end{DoxyParamCaption})}



Writes a new sample to the buffer. Advances the write position by one. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em float} & sample -\/ the new sample to be written. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
bool -\/ true if the sample was successfully written, false otherwise. 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{waveform_8cpp_source_l00018}{18}} of file \mbox{\hyperlink{waveform_8cpp_source}{waveform.\+cpp}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{00018                                     \{ \textcolor{comment}{// T\&\& arg -\/-\/> rvalue reference}}
\DoxyCodeLine{00019     \textcolor{keyword}{auto} writePos = writepos.load(); \textcolor{comment}{//??}}
\DoxyCodeLine{00020     \textcolor{keyword}{auto} nextWritePos = (writePos + 1) \% waveTable.size();}
\DoxyCodeLine{00021 }
\DoxyCodeLine{00022     \textcolor{comment}{// if the buffer is full, overwrite the oldest data}}
\DoxyCodeLine{00023     \textcolor{keywordflow}{if} (nextWritePos == readpos.load()) \{}
\DoxyCodeLine{00024         \textcolor{keyword}{auto} readPos = (readpos.load() + 1) \% waveTable.size();}
\DoxyCodeLine{00025         readpos.store(readPos, std::memory\_order\_release);}
\DoxyCodeLine{00026     \}}
\DoxyCodeLine{00027 }
\DoxyCodeLine{00028     min = std::min(min,arg);}
\DoxyCodeLine{00029     max = std::max(max,arg);}
\DoxyCodeLine{00030     }
\DoxyCodeLine{00031     \textcolor{comment}{// write data to the buffer}}
\DoxyCodeLine{00032     waveTable[writePos] = arg;}
\DoxyCodeLine{00033     writepos.store(nextWritePos);}
\DoxyCodeLine{00034     \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{00035 }
\DoxyCodeLine{00036 \}}

\end{DoxyCode}


The documentation for this class was generated from the following files\+:\begin{DoxyCompactItemize}
\item 
include/\mbox{\hyperlink{waveform_8h}{waveform.\+h}}\item 
src/\mbox{\hyperlink{waveform_8cpp}{waveform.\+cpp}}\end{DoxyCompactItemize}
